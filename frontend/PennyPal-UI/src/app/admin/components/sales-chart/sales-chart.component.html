<div class="bg-white rounded-lg shadow-sm border border-gray-200">
  
  <div class="flex flex-wrap items-center justify-between p-4 md:p-6 border-b border-gray-200 gap-4">
    <div>
      <h3 class="text-lg font-semibold text-gray-900">Monthly Recurring Revenue (MRR)</h3>
      <p class="text-sm text-gray-500">Performance of key subscription tiers</p>
    </div>
    <div class="flex items-center space-x-2 md:space-x-4">
      <div class="flex items-center space-x-3">
        <div *ngFor="let plan of planIds" class="flex items-center">
          <div class="w-3 h-3 rounded-full mr-2" [style.backgroundColor]="planColors[plan.planId]"></div>
          <span class="text-sm text-gray-700 font-medium">{{ plan.planName }}</span>
        </div>
      </div>
      <!-- <div class="relative hidden sm:block">
        <button class="flex items-center text-sm font-medium text-gray-600 bg-gray-50 hover:bg-gray-100 px-3 py-1.5 rounded-md border border-gray-300 transition">
          Last 12 Months
          <svg class="w-4 h-4 ml-2 -mr-1 text-gray-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" d="m19.5 8.25-7.5 7.5-7.5-7.5" />
          </svg>
        </button>
      </div> -->
    </div>
  </div>

  <div class="relative h-80 p-4">
    <svg class="w-full h-full" viewBox="0 0 800 400">
      
      <defs>
        <pattern id="grid" width="80" height="64" patternUnits="userSpaceOnUse">
          <path d="M 80 0 L 0 0 0 64" fill="none" stroke="#e5e7eb" stroke-width="1"/>
        </pattern>
        
        <ng-container *ngFor="let plan of planIds">
          <linearGradient [id]="'gradient-' + plan.planId" x1="0" y1="0" x2="0" y2="1">
            <stop offset="0%" [attr.stop-color]="planColors[plan.planId]" stop-opacity="0.4"/>
            <stop offset="100%" [attr.stop-color]="planColors[plan.planId]" stop-opacity="0"/>
          </linearGradient>
        </ng-container>
      </defs>

      <rect width="100%" height="100%" fill="url(#grid)" />

      <g class="y-axis">
        <text x="35" y="25" text-anchor="end" class="text-sm font-medium fill-gray-600">$150k</text>
        <text x="35" y="89" text-anchor="end" class="text-sm font-medium fill-gray-600">$100k</text>
        <text x="35" y="153" text-anchor="end" class="text-sm font-medium fill-gray-600">$50k</text>
        <text x="35" y="281" text-anchor="end" class="text-sm font-medium fill-gray-600">$0</text>
      </g>

<line x1="40" y1="282" [attr.x2]="chartPoints.length > 0 ? chartPoints[chartPoints.length - 1].x + 40 : 800" y2="282" stroke="#d1d5db" stroke-width="1.5" />      
      <g class="chart-lines" *ngIf="chartPoints.length > 0">
        <ng-container *ngFor="let plan of planIds">
          
          <path 
            [attr.d]="'M' + chartPoints[0].x + ',282 L' + getLinePoints(plan.planId) + ' L' + chartPoints[chartPoints.length - 1].x + ',282 Z'"
            [attr.fill]="'url(#gradient-' + plan.planId + ')'"
          />
          
          <polyline
            [attr.points]="getLinePoints(plan.planId)"
            fill="none"
            [attr.stroke]="planColors[plan.planId]"
            stroke-width="3" 
            class="drop-shadow-sm"
          />
          
          <g *ngFor="let point of chartPoints; let i = index">
            <circle
              [attr.cx]="point.x"
              [attr.cy]="point[plan.planId]"
              r="5" 
              fill="white"
              [attr.stroke]="planColors[plan.planId]"
              stroke-width="2"
              class="hover:r-7 transition-all duration-200 cursor-pointer" 
              (mouseenter)="showTooltip(i, plan.planId, $event)"
              (mouseleave)="hideTooltip()"
            />
          </g>
        </ng-container>
      </g>

      <g class="x-axis">
        <text *ngFor="let point of chartPoints; let i = index"
              [attr.x]="point.x"
              y="310"
              text-anchor="middle"
              class="text-sm font-medium fill-gray-600">
          {{ getMonthLabel(i) }}
        </text>
      </g>
    </svg>

    <div
      *ngIf="tooltip.show"
      class="absolute bg-gray-900 text-white px-3 py-2 rounded-lg shadow-lg text-sm pointer-events-none z-10"
      [style.left.px]="tooltip.x"
      [style.top.px]="tooltip.y"
    >
      <div class="font-medium">{{ tooltip.title }}</div>
      <div>{{ tooltip.value | currency:'USD':'symbol':'1.0-0' }}</div>
    </div>
  </div>
</div>