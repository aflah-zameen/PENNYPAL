<!-- Backdrop -->
    <div *ngIf="isOpen" 
         class="fixed inset-0 bg-black bg-opacity-50 z-50 transition-opacity"
         (click)="close()">
    </div>

    <!-- Sliding Drawer -->
    <div *ngIf="isOpen" 
         class="fixed right-0 top-0 h-full w-full max-w-2xl bg-white shadow-xl z-50 transform transition-transform overflow-y-auto"
         [class.translate-x-0]="isOpen"
         [class.translate-x-full]="!isOpen">
      
      <!-- Header -->
      <div class="sticky top-0 bg-white border-b border-gray-200 px-6 py-4 flex items-center justify-between">
        <h2 class="text-xl font-semibold text-gray-900">Transaction Details</h2>
        <button (click)="close()" 
                class="p-2 hover:bg-gray-100 rounded-full transition-colors">
          <svg class="w-6 h-6 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>

      <div *ngIf="transaction" class="p-6 space-y-6">
        <!-- Basic Information -->
        <div class="bg-gray-50 rounded-lg p-4">
          <h3 class="text-lg font-medium text-gray-900 mb-4">Basic Information</h3>
          <div class="grid grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700">Transaction ID</label>
              <p class="mt-1 text-sm text-gray-900 font-mono">{{transaction.id}}</p>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700">Type</label>
              <span [class]="getTypeClass(transaction.type)" 
                    class="mt-1 inline-flex px-2 py-1 text-xs font-semibold rounded-full">
                {{transaction.type}}
              </span>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700">Status</label>
              <span [class]="getStatusClass(transaction.status)" 
                    class="mt-1 inline-flex px-2 py-1 text-xs font-semibold rounded-full">
                {{transaction.status}}
              </span>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700">Created At</label>
              <p class="mt-1 text-sm text-gray-900">{{transactionService.formatDateTime(transaction.createdAt)}}</p>
            </div>
          </div>
        </div>

        <!-- Users Information -->
        <div class="bg-gray-50 rounded-lg p-4">
          <h3 class="text-lg font-medium text-gray-900 mb-4">Users</h3>
          <div class="space-y-4">
            <!-- From User -->
            <div class="flex items-center space-x-3">
              <img [src]="transaction.fromUser.avatar || '/placeholder.svg?height=48&width=48'" 
                   [alt]="transaction.fromUser.name"
                   class="h-12 w-12 rounded-full">
              <div class="flex-1">
                <p class="text-sm font-medium text-gray-900">{{transaction.fromUser.name}}</p>
                <p class="text-sm text-gray-500">{{transaction.fromUser.email}}</p>
                <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                  From
                </span>
              </div>
            </div>

            <!-- To User -->
            <div *ngIf="transaction.toUser" class="flex items-center space-x-3">
              <img [src]="transaction.toUser.avatar || '/placeholder.svg?height=48&width=48'" 
                   [alt]="transaction.toUser.name"
                   class="h-12 w-12 rounded-full">
              <div class="flex-1">
                <p class="text-sm font-medium text-gray-900">{{transaction.toUser.name}}</p>
                <p class="text-sm text-gray-500">{{transaction.toUser.email}}</p>
                <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800">
                  To
                </span>
              </div>
            </div>
          </div>
        </div>

        <!-- Financial Details -->
        <div class="bg-gray-50 rounded-lg p-4">
          <h3 class="text-lg font-medium text-gray-900 mb-4">Financial Details</h3>
          <div class="space-y-3">
            <div class="flex justify-between">
              <span class="text-sm font-medium text-gray-700">Amount</span>
              <span class="text-sm font-bold text-gray-900">{{transactionService.formatCurrency(transaction.amount)}}</span>
            </div>
            <div *ngIf="transaction.fees" class="flex justify-between">
              <span class="text-sm font-medium text-gray-700">Fees</span>
              <span class="text-sm text-gray-900">{{transactionService.formatCurrency(transaction.fees)}}</span>
            </div>
            <div *ngIf="transaction.fees" class="flex justify-between border-t pt-2">
              <span class="text-sm font-medium text-gray-700">Total</span>
              <span class="text-sm font-bold text-gray-900">{{transactionService.formatCurrency(transaction.amount + transaction.fees)}}</span>
            </div>
          </div>
        </div>

        <!-- Notes -->
        <div *ngIf="transaction.notes" class="bg-gray-50 rounded-lg p-4">
          <h3 class="text-lg font-medium text-gray-900 mb-2">Notes</h3>
          <p class="text-sm text-gray-700">{{transaction.notes}}</p>
        </div>

        <!-- Flag Reason -->
        <div *ngIf="transaction.flagReason" class="bg-red-50 border border-red-200 rounded-lg p-4">
          <h3 class="text-lg font-medium text-red-900 mb-2">Flag Reason</h3>
          <p class="text-sm text-red-700">{{transaction.flagReason}}</p>
        </div>

        <!-- System Information -->
        <div class="bg-gray-50 rounded-lg p-4">
          <h3 class="text-lg font-medium text-gray-900 mb-4">System Information</h3>
          <div class="grid grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700">Retry Attempts</label>
              <p class="mt-1 text-sm text-gray-900">{{transaction.retryAttempts || 0}}</p>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700">Last Updated</label>
              <p class="mt-1 text-sm text-gray-900">{{transactionService.formatDateTime(transaction.updatedAt)}}</p>
            </div>
          </div>
        </div>

        <!-- Admin Notes -->
        <div class="bg-gray-50 rounded-lg p-4">
          <h3 class="text-lg font-medium text-gray-900 mb-4">Admin Notes</h3>
          <form [formGroup]="notesForm" (ngSubmit)="saveNotes()">
            <textarea 
              formControlName="adminNotes"
              rows="4"
              class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"
              placeholder="Add internal admin notes..."
            ></textarea>
            <div class="mt-2 flex justify-end">
              <button 
                type="submit"
                [disabled]="notesForm.invalid"
                class="px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
              >
                Save Notes
              </button>
            </div>
          </form>
        </div>

        <!-- Action Buttons -->
        <div class="border-t pt-6">
          <h3 class="text-lg font-medium text-gray-900 mb-4">Actions</h3>
          <div class="flex flex-wrap gap-3">
            <button 
              *ngIf="transaction.status === 'Success'"
              (click)="reverseTransaction()"
              class="px-4 py-2 bg-red-600 text-white text-sm font-medium rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 transition-colors"
            >
              Reverse Transaction
            </button>
            
            <button 
              *ngIf="transaction.status === 'Failed'"
              (click)="retryTransaction()"
              class="px-4 py-2 bg-green-600 text-white text-sm font-medium rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 transition-colors"
            >
              Retry Transaction
            </button>
            
            <button 
              *ngIf="!transaction.flagReason"
              (click)="markAsSuspicious()"
              class="px-4 py-2 bg-yellow-600 text-white text-sm font-medium rounded-md hover:bg-yellow-700 focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:ring-offset-2 transition-colors"
            >
              Mark as Suspicious
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Confirmation Dialog -->
    <div *ngIf="showConfirmDialog" 
         class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-60">
      <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4">
        <h3 class="text-lg font-medium text-gray-900 mb-4">{{confirmTitle}}</h3>
        <p class="text-sm text-gray-700 mb-6">{{confirmMessage}}</p>
        <div class="flex justify-end space-x-3">
          <button 
            (click)="cancelConfirm()"
            class="px-4 py-2 border border-gray-300 text-gray-700 text-sm font-medium rounded-md hover:bg-gray-50 transition-colors"
          >
            Cancel
          </button>
          <button 
            (click)="executeConfirm()"
            class="px-4 py-2 bg-red-600 text-white text-sm font-medium rounded-md hover:bg-red-700 transition-colors"
          >
            Confirm
          </button>
        </div>
      </div>
    </div>