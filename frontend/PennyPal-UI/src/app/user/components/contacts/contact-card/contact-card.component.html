<div class="bg-white rounded-3xl shadow-xl hover:shadow-2xl transition-all duration-300 p-6 border border-gray-100 group transform hover:scale-105 w-full max-w-md h-[360px] flex flex-col justify-between overflow-hidden">
  
  <div class="flex items-center mb-4">
    <div class="relative">
      <img 
        [src]="contact.profileURL" 
        [alt]="contact.name"
        class="w-16 h-16 rounded-full object-cover border-4 border-white shadow-lg"
      />
      <div 
        *ngIf="contact.isOnline"
        class="absolute -bottom-1 -right-1 w-5 h-5 bg-green-500 border-2 border-white rounded-full animate-pulse"
      ></div>
    </div>
    <div class="ml-4 flex-1">
      <h3 class="font-bold text-gray-800 text-lg">{{ contact.name }}</h3>
      <p class="text-gray-500 text-sm">{{ contact.email }}</p>
    </div>
  </div>

  <div class="flex space-x-3 mb-4">
    <button 
      (click)="onSendMoney(contact)"
      class="flex-1 bg-gradient-to-r from-blue-600 via-purple-600 to-blue-800 text-white px-4 py-2 rounded-lg hover:shadow-lg transition-all duration-300 active:scale-95 flex items-center justify-center font-semibold"
    >
      Send
    </button>
    <button 
      (click)="onMessage(contact)"
      class="flex-1 bg-gradient-to-r from-purple-400 via-purple-500 to-purple-600 text-white px-4 py-2 rounded-lg hover:shadow-lg transition-all duration-300 active:scale-95 flex items-center justify-center font-semibold"
    >
      Message
    </button>
    <button 
      (click)="isRequestModalOpen =true"
      class="flex-1 bg-gradient-to-r from-yellow-500 via-orange-500 to-yellow-600 text-white px-4 py-2 rounded-lg hover:shadow-lg transition-all duration-300 active:scale-95 flex items-center justify-center font-semibold"
    >
      Request
    </button>
  </div>

  <div *ngIf="contact.transactions && contact.transactions.length > 0"
    class="border-t border-gray-100 pt-4 flex-1 overflow-hidden">
    <h4 class="text-sm font-semibold text-gray-600 mb-3">Recent Transactions</h4>

    <div class="space-y-2 overflow-y-auto max-h-[110px] pr-2 scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-transparent">
      <div *ngFor="let transaction of contact.transactions"
          class="flex items-center justify-between text-sm">
          <div class="flex items-center">
            <div class="w-2 h-2 rounded-full mr-2" [ngClass]="{'bg-green-500': transaction.type === 'received', 'bg-blue-500': transaction.type === 'sent'}"></div>
            <span class="text-gray-600">{{ transaction.type === 'sent' ? 'Sent' : 'Received' }}</span>
          </div>
          <div class="flex items-center space-x-2">
            <span class="font-semibold" [ngClass]="{'text-green-600': transaction.type === 'received', 'text-blue-600': transaction.type === 'sent'}">
              {{ transaction.type === 'sent' ? '-' : '+' }}₹{{ transaction.amount }}
            </span>
            <span class="px-2 py-1 rounded-full text-xs font-medium" [ngClass]="{'bg-green-100 text-green-800': transaction.status === 'completed', 'bg-yellow-100 text-yellow-800': transaction.status === 'pending', 'bg-red-100 text-red-800': transaction.status === 'failed'}">
              {{ transaction.status | titlecase }}
            </span>
          </div>
      </div>
    </div>
  </div>
  
  <div *ngIf="!contact.transactions || contact.transactions.length === 0"
          class="border-t border-gray-100 pt-4 flex flex-col items-center justify-center text-center flex-1 transition-all duration-300">
        <div class="w-14 h-14 mb-4 rounded-full bg-gradient-to-br from-gray-100 to-gray-200 shadow-inner flex items-center justify-center">
          <svg class="w-6 h-6 text-gray-400" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round"
              d="M4 6h16M4 10h10M4 14h7M4 18h4" />
          </svg>

        </div>
        <p class="text-sm text-gray-500 font-medium">No recent transactions to show</p>
        <p class="text-xs text-gray-400 mt-1">Start by sending money or messaging your contact</p>
      </div>
</div>

<app-modal-overlay [isOpen]="isRequestModalOpen" (close)="isRequestModalOpen = false">
  <div class="bg-white rounded-2xl shadow-2xl p-8 w-full">
    <h2 class="text-xl font-bold text-gray-800 mb-4">Request To {{ contact.name }}</h2>

    <form #requestForm="ngForm" (ngSubmit)="submitRequest(requestForm)">
      <div class="mb-4">
        <label for="amount" class="block text-sm font-medium text-gray-700 mb-1">Amount</label>
        <input 
          type="number" 
          name="amount"
          placeholder="₹0.00"
          [(ngModel)]="requestAmount"
          required
          min="1"
          #amountField="ngModel"
          class="w-full px-4 py-2 border rounded-lg focus:ring-purple-500 focus:border-purple-500"
          [ngClass]="{'border-red-500': amountField.invalid && amountField.touched}"
        />
        <div *ngIf="amountField.invalid && amountField.touched" class="text-red-600 text-xs mt-1">
          <span *ngIf="amountField.errors?.['required']">Amount is required.</span>
          <span *ngIf="amountField.errors?.['min']">Amount must be greater than 0.</span>
        </div>
      </div>

      <div class="mb-6">
        <label for="message" class="block text-sm font-medium text-gray-700 mb-1">Message</label>
        <textarea 
          name="message"
          rows="3"
          placeholder="e.g., For dinner last night"
          [(ngModel)]="requestMessage"
          required
          #messageField="ngModel"
          class="w-full px-4 py-2 border rounded-lg focus:ring-purple-500 focus:border-purple-500"
          [ngClass]="{'border-red-500': messageField.invalid && messageField.touched}"
        ></textarea>
        <div *ngIf="messageField.invalid && messageField.touched" class="text-red-600 text-xs mt-1">
          A message is required.
        </div>
      </div>

      <div class="mb-6">
        <label for="deadline" class="block text-sm font-medium text-gray-700 mb-1">Repayment Deadline</label>
        <input 
          type="date"
          name="deadline"
          [(ngModel)]="requestDeadline"
          required
          [min]="minDate"
          #deadlineField="ngModel"
          class="w-full px-4 py-2 border rounded-lg focus:ring-purple-500 focus:border-purple-500"
          [ngClass]="{'border-red-500': deadlineField.invalid && deadlineField.touched}"
        />
        <div *ngIf="deadlineField.invalid && deadlineField.touched" class="text-red-600 text-xs mt-1">
          <span *ngIf="deadlineField.errors?.['required']">Deadline is required.</span>
          <span *ngIf="deadlineField.errors?.['min']">Deadline cannot be in the past.</span>
        </div>
      </div>            


      <div class="flex space-x-3">
        <button type="button" (click)="isRequestModalOpen = false" class="flex-1 bg-gray-200 text-gray-700 font-bold py-3 px-4 rounded-lg hover:bg-gray-300 transition-all">
          Cancel
        </button>
        <button type="submit" [disabled]="requestForm.invalid" class="flex-1 bg-gradient-to-r from-yellow-500 to-orange-500 text-white font-bold py-3 px-4 rounded-lg hover:shadow-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed">
          Send Request
        </button>
      </div>
    </form>
  </div>
</app-modal-overlay>
